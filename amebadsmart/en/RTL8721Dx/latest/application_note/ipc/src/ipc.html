<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introduction &mdash; amebadplus_docs  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css?v=a5c4661c" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../_static/toggleprompt.js?v=d7ede5d2"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Direct Memory Access Controller (DMAC)" href="../../dmac/src/index.html" />
    <link rel="prev" title="Inter-Processor Communication (IPC)" href="index.html" />  
     
  <script type="text/javascript" src="../../../_static/js/selector.js"></script>
<style>
      .wy-nav-content {
      max-width: 1000px; /* 设置最大宽度 */
      }
</style>



</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            amebadplus_docs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/at_command/src/index.html">AT Command</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Application Note</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../gcc_build_environment/src/index.html">GCC Build Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sdk_architecture/src/index.html">SDK Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gcc_makefile/src/index.html">GCC Makefile</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sdk_example/src/index.html">SDK Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../flash_memory_layout/index.html">Flash and Memory Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mpu_cache/src/index.html">MPU and Cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../file_system/src/index.html">Virtual File System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mp_image/src/index.html">MP Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ota/src/index.html">OTA Firmware Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chip_en/src/index.html">CHIP Enable</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../boot_process/src/index.html">Boot Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_config/src/index.html">User Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hardware_crypto_engine/src/index.html">Hardware Crypto Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../otpc/src/index.html">One-time Programmable Controller (OTPC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../power_save/src/index.html">Power Saving</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Inter-Processor Communication (IPC)</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#general-principle">General Principle</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-use-ipc">How to Use IPC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ipc-usage-procedure">IPC Usage Procedure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#suggested-usage-of-ipc-get-message">Suggested Usage of ipc_get_message()</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../dmac/src/index.html">Direct Memory Access Controller (DMAC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../psram/src/index.html">Pseudo-Static Random Access Memory (PSRAM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gpio/gpio/src/index.html">General Purpose Input/Output (GPIO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gpio/pinctrl/src/index.html">Pin Controller (Pinctrl)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pinmux/src/index.html">Pin Multiplexing Instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../rtc_io/src/index.html">RTC_IO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ir/src/index.html">Infrared Radiation (IR)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ledc/src/index.html">Light Emitting Diode Controller (LEDC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../trng/src/index.html">True Random Number Generator (TRNG)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../adc/src/index.html">Analog-to-Digital Converter (ADC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cap_touch/src/index.html">Cap-Touch Controller (CTC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../key_scan/src/index.html">Key-Scan</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../audio/src/index.html">Audio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usb_otg/src/index.html">USB OTG</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../wifi/index.html">Wi-Fi</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/software_tools/index.html">Software Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ameba/en/mp_tools/src/index.html">MP Tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">amebadplus_docs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Application Note</a></li>
          <li class="breadcrumb-item"><a href="index.html">Inter-Processor Communication (IPC)</a></li>
      <li class="breadcrumb-item active">Introduction</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/application_note/ipc/src/ipc.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="introduction">
<span id="ipc"></span><h1>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h1>
<p>There are two-CPUs named KM4 (AP) and KM0 (NP) integrated in the AmebaDPlus. The inter-processor communication (IPC) hardware is designed to make these CPUs communicate with each other. Also, a KM0 shared SRAM is used to transmit information to each other. The block diagram is shown in the following figure.</p>
<figure class="align-center" id="ipc-block-diagram">
<a class="reference internal image-reference" href="../../../_images/ipc_block_diagram.svg"><img alt="../../../_images/ipc_block_diagram.svg" height="105" src="../../../_images/ipc_block_diagram.svg" width="399" /></a>
<figcaption>
<p><span class="caption-text">IPC block diagram</span><a class="headerlink" href="#ipc-block-diagram" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="general-principle">
<h1>General Principle<a class="headerlink" href="#general-principle" title="Link to this heading"></a></h1>
<p>There are 2 directions for 2 cores to communicate with each other: KM0 ←→ KM4. There are 16 TX channels and 16 RX channels for each direction. All the channels are processed independently. That means one core can send different information to another core through different channels at any time, the channels will not affect each other.</p>
<p>Each channel has one transmit side and one receive side, the transmit side and the receive side of the same channel is a pair. For example, KM0 sends an IPC to KM4 through channel 7, the transmit side is KM0 channel 7, and receive side is KM4 channel 7, and information is sent from KM0 channel 7 to KM4 channel 7.</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="../../../_images/ipc_schematic_diagram.svg"><img alt="../../../_images/ipc_schematic_diagram.svg" height="127" src="../../../_images/ipc_schematic_diagram.svg" width="484" /></a>
<figcaption>
<p><span class="caption-text">IPC schematic diagram</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="how-to-use-ipc">
<h1>How to Use IPC<a class="headerlink" href="#how-to-use-ipc" title="Link to this heading"></a></h1>
<section id="ipc-usage-procedure">
<h2>IPC Usage Procedure<a class="headerlink" href="#ipc-usage-procedure" title="Link to this heading"></a></h2>
<p>For example, KM0 sends an IPC to KM4 through channel 8.</p>
<ol class="arabic">
<li><p>Register the receiver IRQ handler function of the selected channel in receiver IPC.</p>
<p>In this case, add a new IPC_INIT_TABLE in the KM4 for channel 8 of KM0 to KM4. Rx IRQ handler, Rx IRQ data, Tx IRQ handler, Tx IRQ data, IPC direction and IPC channel should be set and defined. If message exchange is needed, you should specify the message type: data or point.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">IPC_TABLE_DATA_SECTION</span>
<span class="linenos">2</span><span class="n">Const</span><span class="w"> </span><span class="n">IPC_INIT_TABLE</span><span class="w"> </span><span class="n">ipc_channel8_table</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">3</span><span class="p">{</span><span class="n">IPC_USER_DATA</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_CHANNEL8_ipc_int</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">VOID</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_TXHandler</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">VOID</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">IPC_KM0_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_N2A_Channel8</span><span class="p">},</span>
<span class="linenos">4</span><span class="p">};</span>
</pre></div>
</div>
</li>
<li><p>Uncomment the corresponding channel in <code class="docutils literal notranslate"><span class="pre">ameba_ipccfg.h</span></code> and add some description as shown below. This macro is used in step <a class="reference internal" href="#ipc-usage-procedure-step-5"><span class="std std-ref">5</span></a>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cm">/** @defgroup IPC_KM0_Tx_Channel</span>
<span class="linenos"> 2</span><span class="cm">* @{</span>
<span class="linenos"> 3</span><span class="cm">*/</span>
<span class="linenos"> 4</span><span class="cp">#define IPC_N2A_TICKLESS_INDICATION  0  </span><span class="cm">/*!&lt; KM0 -&gt; KM4 Tickless indicate */</span>
<span class="linenos"> 5</span><span class="cp">#define IPC_N2A_WAKE_AP          1  </span><span class="cm">/*!&lt; KM0 -&gt; KM4 Wakeup*/</span>
<span class="linenos"> 6</span><span class="cp">#define IPC_N2A_WIFI_FW_INFO      2  </span><span class="cm">/*!&lt; KM0 -&gt; KM4 FW Info*/</span>
<span class="linenos"> 7</span><span class="cp">#define IPC_N2A_FLASHPG_REQ        3  </span><span class="cm">/*!&lt; KM0 -&gt; KM4 Flash Program REQUEST*/</span>
<span class="linenos"> 8</span><span class="cp">#define IPC_N2A_LOGUART_RX_SWITCH    4  </span><span class="cm">/*!&lt; KM0 -&gt; KM4 Loguart Rx Switch*/</span>
<span class="linenos"> 9</span><span class="cp">#define IPC_N2A_BT_API_TRAN        5  </span><span class="cm">/*!&lt; KM0 -&gt; KM4 BT API Exchange */</span>
<span class="linenos">10</span><span class="c1">// #define IPC_N2A_BT_DATA_TRAN      5  /*!&lt; KM0 -&gt; KM4 BT DATA Exchange */</span>
<span class="linenos">11</span><span class="cp">#define IPC_N2A_WIFI_TRX_TRAN      6  </span><span class="cm">/*!&lt; KM0 -&gt; KM4 WIFI Message Exchange */</span>
<span class="linenos">12</span><span class="cp">#define IPC_N2A_WIFI_API_TRAN      7  </span><span class="cm">/*!&lt; KM0 -&gt; KM4 API WIFI Message Exchange */</span>
<span class="hll"><span class="linenos">13</span><span class="cp">#define IPC_N2A_Channel8        8</span>
</span><span class="linenos">14</span><span class="c1">//#define IPC_N2A_Channel9        9</span>
<span class="linenos">15</span><span class="c1">//#define IPC_N2A_Channel10        10</span>
<span class="linenos">16</span><span class="c1">//#define IPC_N2A_Channel11        11</span>
<span class="linenos">17</span><span class="c1">//#define IPC_N2A_Channel12        12</span>
<span class="linenos">18</span><span class="c1">//#define IPC_N2A_Channel13        13</span>
<span class="linenos">19</span><span class="c1">//#define IPC_N2A_Channel14        14</span>
<span class="linenos">20</span><span class="c1">//#define IPC_N2A_Channel15        15</span>
<span class="linenos">21</span><span class="cm">/**</span>
<span class="linenos">22</span><span class="cm">* @}</span>
<span class="linenos">23</span><span class="cm">*/</span>
</pre></div>
</div>
</li>
</ol>
<ol class="arabic simple" id="ipc-usage-procedure-step-3" start="3">
<li><p>Register the transmit IRQ handler function of the selected channel in transmit IPC and uncomment the corresponding channel. This step is <code class="docutils literal notranslate"><span class="pre">optional</span></code> , because this step is for register Tx interrupt, which is for transmit IPC to know that the receiver IPC has received this IPC. In this case, add a new IPC_INIT_TABLE in the KM0 for channel 8 of KM0 to KM4.</p></li>
</ol>
<ol class="arabic simple" id="ipc-usage-procedure-step-4" start="4">
<li><p>SDK will enable the IPC receiver interrupt of KM4 and transmit interrupt of KM0 (if configured in step <a class="reference internal" href="#ipc-usage-procedure-step-3"><span class="std std-ref">3</span></a>) according to <code class="docutils literal notranslate"><span class="pre">IPC_INIT_TABLE</span></code> , and register the corresponding IRQ handler and data for the channel.</p></li>
</ol>
<ol class="arabic" id="ipc-usage-procedure-step-5" start="5">
<li><p>When KM0 sends an IPC request to KM4 through channel 8, it should call <code class="docutils literal notranslate"><span class="pre">ipc_send_message()</span></code> and specify the channel number and message. If no message is needed, just input NULL for the third parameter of <code class="docutils literal notranslate"><span class="pre">ipc_send_message</span> <span class="pre">()</span></code> .</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">IPC_MSG_STRUCT</span><span class="w"> </span><span class="n">ipc_msg_temp</span><span class="p">;</span>
<span class="linenos">2</span><span class="c1">// init ipc_msg</span>
<span class="linenos">3</span><span class="n">ipc_msg_temp</span><span class="p">.</span><span class="n">msg_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IPC_USER_POINT</span><span class="p">;</span>
<span class="linenos">4</span><span class="n">ipc_msg_temp</span><span class="p">.</span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="o">&amp;</span><span class="n">tmp_np_log_buf</span><span class="p">;</span>
<span class="linenos">5</span><span class="n">ipc_msg_temp</span><span class="p">.</span><span class="n">msg_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="linenos">6</span><span class="n">ipc_msg_temp</span><span class="p">.</span><span class="n">rsvd</span><span class="w"> </span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">7</span><span class="c1">//send ipc message</span>
<span class="linenos">8</span><span class="n">ipc_send_message</span><span class="p">(</span><span class="n">IPC_KM0_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_N2A_Channel8</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">ipc_msg_temp</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>After receiving IPC from KM0 channel8, KM4 will enter IPC interrupt handler and the corresponding receive IRQ handler will be executed, call <code class="docutils literal notranslate"><span class="pre">ipc_get_message()</span></code> to get the message if needed.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PIPC_MSG_STRUCT</span><span class="w"> </span><span class="n">ipc_msg_temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">PIPC_MSG_STRUCT</span><span class="p">)</span><span class="n">ipc_get_message</span><span class="p">(</span><span class="n">IPC_KM0_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_N2A_Channel8</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>If you have configured in step <a class="reference internal" href="#ipc-usage-procedure-step-3"><span class="std std-ref">3</span></a>, after KM4 receives the IPC, KM0 also enters IPC interrupt handler and executes the corresponding transmit IRQ handler.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Several channels are already used by Realtek, you can use the remaining channels.</p>
</div>
</section>
<section id="suggested-usage-of-ipc-get-message">
<h2>Suggested Usage of ipc_get_message()<a class="headerlink" href="#suggested-usage-of-ipc-get-message" title="Link to this heading"></a></h2>
<ul>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">ipc_get_message()</span></code> in IPC interrupt handle or user interrupt handler.</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kt">void</span><span class="w"> </span><span class="nf">IPC_CHANNEL8_ipc_int</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">Data</span><span class="p">,</span><span class="w"> </span><span class="n">u32</span><span class="w"> </span><span class="n">IrqStatus</span><span class="p">,</span><span class="w"> </span><span class="n">u32</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">)</span>
<span class="linenos">2</span><span class="p">{</span>
<span class="linenos">3</span><span class="cm">/* To avoid gcc warnings */</span>
<span class="linenos">4</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">Data</span><span class="p">;</span>
<span class="linenos">5</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">IrqStatus</span><span class="p">;</span>
<span class="linenos">6</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span>
<span class="linenos">7</span><span class="n">PIPC_MSG_STRUCT</span><span class="w">  </span><span class="n">ipc_msg_temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">PIPC_MSG_STRUCT</span><span class="p">)</span><span class="n">ipc_get_message</span><span class="p">(</span><span class="n">IPC_KM0_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_N2A_Channel8</span><span class="p">);</span>
<span class="linenos">8</span><span class="n">u32</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ipc_msg_temp</span><span class="o">-&gt;</span><span class="n">msg</span><span class="p">;</span>
<span class="linenos">9</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">IPC_TABLE_DATA_SECTION</span>
<span class="linenos">2</span><span class="k">const</span><span class="w"> </span><span class="n">IPC_INIT_TABLE</span><span class="w"> </span><span class="n">ipc_channel8_table</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">3</span><span class="p">{</span><span class="n">IPC_USER_DATA</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_CHANNEL8_ipc_int</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">VOID</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_TXHandler</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">VOID</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_KM0_TO_KM4</span><span class="p">,</span><span class="w"> </span><span class="n">IPC_N2A_Channel8</span><span class="p">},</span>
<span class="linenos">4</span><span class="p">};</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">IPC_MSG_STRUCT</span></code> is no need to cache invalidation any more after <code class="docutils literal notranslate"><span class="pre">ipc_get_message()</span></code>.</p>
<blockquote>
<div><figure class="align-center">
<a class="reference internal image-reference" href="../../../_images/ipc_suggested_usage_fig1.png"><img alt="../../../_images/ipc_suggested_usage_fig1.png" src="../../../_images/ipc_suggested_usage_fig1.png" style="width: 568.75px; height: 82.55px;" /></a>
</figure>
</div></blockquote>
</li>
<li><p>Forcing <code class="docutils literal notranslate"><span class="pre">IPC_MSG_STRUCT</span></code> type conversion has risks.</p>
<blockquote>
<div><figure class="align-center">
<a class="reference internal image-reference" href="../../../_images/ipc_suggested_usage_fig2.png"><img alt="../../../_images/ipc_suggested_usage_fig2.png" src="../../../_images/ipc_suggested_usage_fig2.png" style="width: 879.9px; height: 309.4px;" /></a>
</figure>
</div></blockquote>
</li>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">ipc_get_message()</span></code> in task also has risks.</p>
<blockquote>
<div><figure class="align-center">
<a class="reference internal image-reference" href="../../../_images/ipc_suggested_usage_fig3.png"><img alt="../../../_images/ipc_suggested_usage_fig3.png" src="../../../_images/ipc_suggested_usage_fig3.png" style="width: 750.4px; height: 373.09999999999997px;" /></a>
</figure>
</div></blockquote>
</li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">ipc_get_message()</span></code> needs to be used in <code class="docutils literal notranslate"><span class="pre">task</span></code> , do as follows:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Task takes the semaphore.</p></li>
<li><p>In IPC Rx user interrupt handle, using <code class="docutils literal notranslate"><span class="pre">ipc_get_message()</span></code> to get a message.</p></li>
<li><p>Copy the message to another memory after getting message in the same Rx user interrupt handle.</p></li>
<li><p>Give semaphore.</p></li>
</ol>
<p>Then task can use the message.</p>
</div></blockquote>
</li>
</ul>
</section>
</section>
<section id="troubleshooting">
<h1>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h1>
<p>If <code class="docutils literal notranslate"><span class="pre">Channel</span> <span class="pre">Conflict</span> <span class="pre">for</span> <span class="pre">CPU</span> <span class="pre">xx</span> <span class="pre">Channel</span> <span class="pre">xx!</span></code> log shows up, it means two IRQ functions are registered in the same channel. For example, if IRQFunc1 and IRQFunc2 are both registered in KM4 for KM0 to KM4 channel1, the log will show up as below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>14:23:03.905 [MODULE_IPC-LEVEL_ERROR]: Channel Conflict for CPU 1 Channel1 ! Ignore If CPU Has Reset
</pre></div>
</div>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../_images/ipc_troubleshooting.png"><img alt="../../../_images/ipc_troubleshooting.png" src="../../../_images/ipc_troubleshooting.png" style="width: 857.6px; height: 616.8000000000001px;" /></a>
</figure>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Inter-Processor Communication (IPC)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../dmac/src/index.html" class="btn btn-neutral float-right" title="Direct Memory Access Controller (DMAC)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Realsil.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>